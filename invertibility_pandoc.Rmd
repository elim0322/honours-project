Invertible workflow using Pandoc
===============================

Introduction
------------
[Pandoc](http://johnmacfarlane.net/pandoc/) is a "universal document converter" that provides document conversion between various formats. The tool is much more generalised than our proposed invertible, reproducible workflow using **knitr** to support nearly every markup format that exists today. As a student undertaking a project associated with document generation, it is worthwhile to explore any insights that Pandoc can provide to assist in my project. 

Markdown format
---------------
The primary purpose of the [Markdown](http://daringfireball.net/projects/markdown/) format is to incorporate readability in its plain text formatting syntax (easy-to-read and easy-to-write plain text format), rather than the often used, complex markup document format. Although Markdown documents are originally intended to be viewed as they are (i.e., their source code), they can also be converted naturally  to the HTML format to be viewed in a web browser.

As of the June 2014 update, **RStudio** supports "next generation of R Markdown based on pandoc" which means a Markdown document can be converted to HTML, PDF and Word documents by **RStudio** of version 0.98.932 and above. This update is most likely to influence users to rely on using Markdown documentation more frequently, if not before, due to the increased document generation flexibility.

Considering these facts, the Markdown format is chosen to be the primary test format in this experiment.

Invertibility of Pandoc
-----------------------
As an initial step of the experiment, Pandoc must be tested to show whether it supports perfect, flawless inversion between two document formats, that is, the source code must be identical to the new source code generated after the inversion. If Pandoc supports it, we can safely assume that the conceptual basis of the invertibility is at least similar between Pandoc and my project and carry on further experimentation. If not, Pandoc defeats the core purpose and logic used in the project to suggest that the experiment can be terminated at this stage.

A simple Markdown document from http://rmarkdown.rstudio.com/ is used as an example. Below is the source code of the example document, `example.md`:

    Header 1
    -------------------------------------------------
    This is an R Markdown document. Markdown is a
    simple formatting syntax for authoring web pages.
    
    Use an asterisk mark, to provide emphasis such as
    *italics* and **bold**.
    
    Create lists with a dash:
    - Item 1
    - Item 2
    - Item 3
    
    You can write `in-line` code with a back-tick.
    
    ```
    Code blocks display
    with fixed-width font
    ```
    
    > Blockquotes are offset
    

**knitr** supports Pandoc in its own way by allowing users, who are not familiar with the command line syntax, to execute Pandoc document conversion in the R syntax ([demo](http://yihui.name/knitr/demo/pandoc/)). The R code below is used to generate an HTML document based on `example.md`. The last line of the below R code is not correctly processed by **knitr** and `example.html` is not converted to `example.return.md`, unless a config file (a simple text file) containing optional arguments for Pandoc is created and called locally. This may be a bug in **knitr** or a way to prevent the invertible process between the two document formats.

```{r}
library(knitr)
# generate 'example.html' based on 'example.md'
pandoc('example.md', format='html')
# generate 'example.return.md' based on 'example.html'
pandoc('example.html', ext='return.md', format='markdown')
```

Alternatively, we can use the below R code in the command line syntax to correctly generate the document `example.return.md`.

```{r}
system("pandoc -o example.return.md example.md")
```

The code structure of `example.return.md` can be seen below:

    Header 1
    --------
    
    This is an R Markdown document. Markdown is a simple formatting syntax
    for authoring web pages.
    
    Use an asterisk mark, to provide emphasis such as *italics* and
    **bold**.
    
    Create lists with a dash: - Item 1 - Item 2 - Item 3
    
    You can write `in-line` code with a back-tick.
    
        Code blocks display
        with fixed-width font
    
    > Blockquotes are offset
    
    

The source documents, `example.md` and `example.return.md`, have different code structures. Most commonly, Pandoc inserts and deletes carriage returns on its own to result in a document of different length in comparison to the initial document length. If the sole difference between the two source documents is in the amount of white spaces, that are inserted by Pandoc, then we can safely ignore this issue by using the option, `-b`, in using `diff` command to ignore changes in the amount of white spaces. Then `diff` will not detect any changes to suggest that the source documents are identical. However Pandoc not only manipulates carriage returns but also attempts to break lines of code in its own way to result in a difference that cannot be ignored by `diff`.

More serious problems are the deleted dashes in the second line of the documents (for the heading) and the use of different syntax to display code blocks. Both problems will result as distinct differences detected by `diff`:

```{r}
system("diff -b example.md example.return.md")
```

Conclusion
----------
It is evident from the experiment that Pandoc does not support the concept of invertible, reproducible document generation. For invertibility a source document must be identical to the new source document after inversion, or at least to the extent where `diff` can be used reliably. Pandoc fails to deliver the invertibility concept that is essential to the invertible reproducibility and therefore deviates from my project. Pandoc achieves conversion between various document formats which is to say that it is much more generalised. However it cannot be implemented as an alternative workflow for the invertible reproducible document generation.


